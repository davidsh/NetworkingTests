# Build Docker image for this app, to be published to Docker Registry
pool:
  vmImage: 'ubuntu-16.04'
variables:
  buildConfiguration: 'Release'
steps:
- script: |
    # Fix up permissions on script
    chmod +x $(System.DefaultWorkingDirectory)/testnetwork/runtests-pipelines.sh

- task: Bash@3
  inputs:
    displayName: 'Building and running tests'
    targetType: 'filePath'
    filePath: $(System.DefaultWorkingDirectory)/testnetwork/runtests-pipelines.sh
    arguments: $(System.DefaultWorkingDirectory)
    workingDirectory: $(System.DefaultWorkingDirectory)

- task: PublishTestResults@2
  inputs:
    testRunner: VSTest
    testResultsFiles: '**/*.trx'
    failTaskOnFailedTests: true
